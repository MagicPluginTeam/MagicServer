# 라이선스 서버

***

**작동 방식**

1. (서버) 라이선스 접속 시도 감지시, worker-thread 생성
2. (서버) 클라이언트 IP수집, 임시 저장
3. (서버) RSA Key Pair 생성
4. (서버) 클라이언트로 public key 전송
5. (클라이언트) AES key 생성, public key로 암호화 후, 서버로 전송
6. (서버) AES키를 private key로 복호화
7. (서버) AES key로 클라이언트 IP 암호화 후, 클라이언트로 전송
8. (클라이언트) 받은 암호화 된 IP를 AES key로 복호화 후, 동일한지 확인 - 서버 to 클라이언트 상태 확인
9. (클라이언트) public key로 MACAddr 암호화 후 전송
10. (서버) private key로 암호화 된 MACAddr 복호화 후, 등록되어 있는지 확인
11. (클라이언트) license.lic를 AES로 1차 암호화 후, public key로 2차 암호화 후 서버로 전송
12. (서버) license.lic 복호화 후 임시 저장
13. (클라이언트) AES로 암호화 된 UUID.uid 전송
14. (서버) UUID.uid 복호화 후 임시 저장
15. (서버) 해당 UUID가 구매 목록에 있는지 확인 - 없다면, 비활성화/연결종료
16. (서버) license.lic가 올바른지 확인 - 다르다면 해당 UUID 블랙리스트 등재 후, 비활성화/연결종료
17. (서버) 해당 UUID의 IP슬롯에 클라이언트의 IP가 존재하는지 확인 - 없다면 블랙리스트 등재 후,  비활성화/연결종료
18. (서버) 해당 UUID를 AES key로 암호화 후 클라이언트로 전송
19. (클라이언트) 받은 UUID를 AES key로 복호화 - 가지고 있는 UUID와 비교 / 다르다면, 비활성화/연결종료
20. (클라이언트) 플러그인 활성화

***

**제작할 것**

1. 이메일 인증 모듈 제작
2. 라이선스 확인 라이브러리 제작
3. 대시보드
   1. UUID 재발급 가능 (이메일 인증 필요)
   2. 블랙리스트 관리 가능
   3. 특정 IP/MAC 주소를 표시하며 그중 선택하여 접속 권한 삭제 가능
   4. 특정 IP/MAC 주소를 입력하여 블랙리스트 등록 가능
   5. 접속 제한 수량 초과 시, UUID 비활성화되면 재활성화 (이메일 인증 필요)

***

**할 것**

1. MACAddr, IP 동의 받아야함 (수집/저장/이용)
2. 플러그인별 license.lic에 들어갈 내용 결정 (레이아웃)
3. EULA 규약 제정
4. 디자이너(로고, 웹 레이아웃) 구인
5. 웹 개발자 구인
6. VPN의 IP 차단(https://github.com/ejrv/VPNs/blob/master/vpn-ipv4.txt)

***

**Data Schema**

1. License Schema
   2. owner-user-id
      1. items [Array]
         1. product-id [Array]
            1. license-uuid
            2. allowed [Array]
               1. ip-address
               2. mac-address
            3. blocked [Array]
               1. ip-address
               2. mac-address
            4. max-ip-slot-size
            5. is-uuid-locked
2. ShioppingCart Schema
   1. user-id
      1. items [Array]
         1. product-id
         2. count
         3. added-date
3. Product Schema
   1. product-id (UUID, DashBar Removed)
      1. title
      2. description
      3. tag
      4. price
      5. created-date
      6. last-updated-date
      7. is-sold-out
      8. thumbnail
      9. product-image-paths [5 Array]
      10. qnas [Array]
          1. qna-id
          2. user-id
          3. title
          4. content
          5. created-date
          6. last-updated-date
          7. is-secret
          8. is-solved
      11. review [Array]
          1. user-id
          2. title
          3. content
          4. created-date
          5. last-updated-date
          6. rating
4. User Schema
   1. user-id
      1. username
      2. email
      3. password-hash
      4. last-hogin-date
      5. registered-date
      6. is-admin
5. PublicBannedUser Schema
  1. user-id
  2. added-date
  3. mac-address
  4. ip-address
